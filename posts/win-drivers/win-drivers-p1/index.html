<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>0x01 Introduction and Fundamentals | Tx0actical's Blog</title><meta name=keywords content="Drivers,Windows"><meta name=description content="Writing Windows KMDF Drivers for Fun and Exploitation - Part 1"><meta name=author content="Tx0actical"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.1c07360e4073b5876dcd040619ee052e1c5c6f1507af5a552afd6deb8cf59325.css integrity="sha256-HAc2DkBztYdtzQQGGe4FLhxcbxUHr1pVKv1t64z1kyU=" rel="preload stylesheet" as=style><link rel=icon href=https://Tx0actical.github.io/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://Tx0actical.github.io/favicon_io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://Tx0actical.github.io/favicon_io/favicon-32x32.png><link rel=apple-touch-icon href=https://Tx0actical.github.io/favicon_io/apple-touch-icon.png><link rel=mask-icon href=https://Tx0actical.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-S0DZQ0T5JT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S0DZQ0T5JT",{anonymize_ip:!1})}</script><meta property="og:title" content="0x01 Introduction and Fundamentals"><meta property="og:description" content="Writing Windows KMDF Drivers for Fun and Exploitation - Part 1"><meta property="og:type" content="article"><meta property="og:url" content="https://Tx0actical.github.io/posts/win-drivers/win-drivers-p1/"><meta property="og:image" content="https://Tx0actical.github.io/images/Lissajous_curve_5by4.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-26T18:48:34+05:30"><meta property="article:modified_time" content="2023-02-26T18:48:34+05:30"><meta property="og:site_name" content="Tx0actical's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://Tx0actical.github.io/images/Lissajous_curve_5by4.svg"><meta name=twitter:title content="0x01 Introduction and Fundamentals"><meta name=twitter:description content="Writing Windows KMDF Drivers for Fun and Exploitation - Part 1"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://Tx0actical.github.io/posts/"},{"@type":"ListItem","position":2,"name":"0x01 Introduction and Fundamentals","item":"https://Tx0actical.github.io/posts/win-drivers/win-drivers-p1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"0x01 Introduction and Fundamentals","name":"0x01 Introduction and Fundamentals","description":"Writing Windows KMDF Drivers for Fun and Exploitation - Part 1","keywords":["Drivers","Windows"],"articleBody":"Hello.\nThis is the first part in the series, “Writing Windows Kernel-Mode Drivers for Fun and Profit”.\nThis series will help you understand and write KMDF drivers, and maybe exploit them in red team engagements or DoS your own/or others’ system/VM if you messed up.\nA basic DriverEntry routine definition looks something like this -\u003e\n1 2 3 4 5 NTSTATUS DriverEntry (_In_ PDRIVER_OBJECT DriverObject, _In_ PUNICODE_STRING RegistryPath) { UNREFERENCED_PARAMETER (DriverObject); UNREFERNECED_PARAMETER (RegistryPath); return STATUS_SUCCESS; } While this may look intimidating at first, brushing up on OS Concepts, Windows Internals, C/C++ knowledge, and some persistence will help you better understand stuff that’s about to come.\nWe’ll be dealing mostly with Kernel-Mode or KMDF drivers (explained later), so unless explicitly stated, a driver means a KMDF driver.\nFor further details, I recommend Windows Internals by Pavel Yosifovich, Alex Ionescu, Mark E. Russinovich, David A. Solomon and Windows Kernel Programming by Pavel Yosifovich. This post and the upcoming ones took inspiration from their work.\nBy the way, DriverEntry is just the main of the driver.\nDrivers… Who dis? Drivers are Structured, High Privilege Deployable Kernel modules operating in Ring 0 processor privilege level (only kernel-mode drivers), same as the kernel. Initially, Ring 1 and Ring 2 were reserved for drivers but nobody uses them anymore.\nDrivers provide a way to interact with (in most cases) hardware devices. These are called Hardware Drivers. On the contrary, software components that execute kernel-level privilege tasks such as file creation, are classified under Software Drivers.\nTo write drivers, you need to follow a set of guidelines, conventions, and structures, all these together combine to form a Driver Framework. Two of these exist -\u003e Windows Driver Model (WDM) and Windows Driver Foundation (WDF).\nWDM vs WDF Simply put, WDM is an older, more complex-to-work-with framework to write drivers. Ideal for writing File Systems or File System Filter drivers, WDM provides greater control over kernel objects and is hard to write, debug, and maintain.\nWDM objects are system-wide objects accessible to drivers and are referenced by pointers. A driver that corrupts a WDM object corrupts the entire system. WDM drivers are trusted kernel components, hence OS does fewer checks to validate data.\nFrom a security perspective, leveraging a framework that provides higher control than WDF, would enable more stealth during offensive engagements.\nWDF is a new, easier-to-work-with framework that abstracts a lot of details of WDM. It supports a coherent object model in which objects are invisible to drivers.\nCorrupting a WDF Driver is not only more difficult - as the framework evaluates data being supplied - but also causes system-wide problems less often.\nApart from these, there are many more subtle differences such as how both handle I/O requests. For eg. In a WDM driver, I/O dispatch routines map to particular IRP codes whereas, in a WDF driver, the framework registers its own dispatch routines, follows some identical steps to WDM, and then invokes the driver’s event callback functions.\nEvent callback functions do a more specific task than the general I/O dispatch routines of WDM.\nRegardless of details, the bottom line is, WDM is complex and much harder to work with while WDF is easier to understand, the tradeoff being the abstraction.\nRequirements There are some tools and methodologies that are recommended while working with drivers.\nTo build and deploy drivers you require the Windows Software Development Kit (SDK), Windows Driver Kit (WDK), and Visual Studio 2022 (the latest as of this writing). You can find them here and Visual Studio here.\nMake sure SDK and WDK versions match, this is important.\nAdditionally, you’d require a Visual Studio extension, “Windows Driver Kit”. That should be automatically installed if WDK is configured correctly.\nTo test drivers, you’ll need a Windows Virtual Machine, with Windows SDK and WDK installed.\nSysInternals Tools is a must.\nFinal Thoughts Driver Development is not something you do regularly unless you have to.\nThe purpose is to understand Windows internals and drivers to build anything from Anti-Virus Filter Drivers to Rootkits. Knowing Driver Development also develops Kernel Debugging skills which are great if you are interested in Windows vulnerability research.\nIn Part 2, you’ll learn the Advanced Windows Internals concepts required to get started with drivers.\nStay Tuned.\nTx0actical. Out.\n","wordCount":"706","inLanguage":"en","image":"https://Tx0actical.github.io/images/Lissajous_curve_5by4.svg","datePublished":"2023-02-26T18:48:34+05:30","dateModified":"2023-02-26T18:48:34+05:30","author":{"@type":"Person","name":"Tx0actical"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://Tx0actical.github.io/posts/win-drivers/win-drivers-p1/"},"publisher":{"@type":"Organization","name":"Tx0actical's Blog","logo":{"@type":"ImageObject","url":"https://Tx0actical.github.io/favicon_io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><script>const hideNonNeededElement=()=>{const s=window.innerWidth,n=document.getElementsByClassName("logo-switches")[0],e=document.getElementsByClassName("logo-swtich-display-a")[0],t=document.getElementsByClassName("logo-swtich-display-b")[0];s<616?(e.childNodes.length===0&&e.append(n),t.childNodes?.[0]?.remove()):(t.childNodes.length===0&&t.append(n),e.childNodes?.[0]?.remove())};window.addEventListener("resize",hideNonNeededElement),window.addEventListener("load",hideNonNeededElement)</script><nav class=nav><div class=logo><a href=https://Tx0actical.github.io/ accesskey=h title="Tx0actical (Alt + H)">Tx0actical</a><div class=logo-swtich-display-a></div></div><div style=display:flex;flex-direction:row><ul id=menu><li><a href=https://Tx0actical.github.io/about/ title=About><span>About</span></a></li><li><a href=https://Tx0actical.github.io/writeups title=Writeups><span>Writeups</span></a></li><li><a href=https://Tx0actical.github.io/win-drivers title=Drivers><span>Drivers</span></a></li><li><a href=https://Tx0actical.github.io/projects title=Projects><span>Projects</span></a></li></ul><div class=logo-swtich-display-b><div class=logo-switches><button id=theme-toggle accesskey=t class=theme-toggle-right title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div></div></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://Tx0actical.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://Tx0actical.github.io/posts/>Posts</a></div><h1 class=post-title>0x01 Introduction and Fundamentals</h1><div class=post-description>Writing Windows KMDF Drivers for Fun and Exploitation - Part 1</div><div class=post-meta><span title='2023-02-26 18:48:34 +0530 IST'>February 26, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;706 words&nbsp;·&nbsp;Tx0actical&nbsp;|&nbsp;<a href=https://github.com/Tx0actical/Tx0actical.github.io/pulls rel="noopener noreferrer" target=_blank>Suggestions?</a></div></header><figure class=entry-cover><img loading=lazy src=https://Tx0actical.github.io/images/Lissajous_curve_5by4.svg alt="Lissajous Curve"><p><a href="https://commons.wikimedia.org/w/index.php?curid=1484162">Lissajous Curve</a> By Alessio Damato</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#drivers-who-dis>Drivers&mldr; Who dis?</a></li><li><a href=#wdm-vs-wdf>WDM vs WDF</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#final-thoughts>Final Thoughts</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Hello.</p><p>This is the first part in the series, &ldquo;Writing Windows Kernel-Mode Drivers for Fun and Profit&rdquo;.</p><p>This series will help you understand and write KMDF drivers, and maybe exploit them in red team engagements or DoS your own/or others&rsquo; system/VM if you messed up.</p><p>A basic <code>DriverEntry</code> routine definition looks something like this -></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>NTSTATUS</span> <span class=nf>DriverEntry</span> <span class=p>(</span><span class=n>_In_</span> <span class=n>PDRIVER_OBJECT</span> <span class=n>DriverObject</span><span class=p>,</span> <span class=n>_In_</span> <span class=n>PUNICODE_STRING</span> <span class=n>RegistryPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>UNREFERENCED_PARAMETER</span> <span class=p>(</span><span class=n>DriverObject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>UNREFERNECED_PARAMETER</span> <span class=p>(</span><span class=n>RegistryPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>STATUS_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>While this may look intimidating at first, brushing up on OS Concepts, Windows Internals, C/C++ knowledge, and some persistence will help you better understand stuff that&rsquo;s about to come.</p><p>We&rsquo;ll be dealing mostly with Kernel-Mode or KMDF drivers (explained later), so unless explicitly stated, a driver means a KMDF driver.</p><blockquote><p>For further details, I recommend <a href=https://www.microsoftpressstore.com/store/windows-internals-part-1-system-architecture-processes-9780735684188>Windows Internals</a> by Pavel Yosifovich, Alex Ionescu, Mark E. Russinovich, David A. Solomon and <a href=https://leanpub.com/windowskernelprogrammingsecondedition>Windows Kernel Programming</a> by Pavel Yosifovich. This post and the upcoming ones took inspiration from their work.</p></blockquote><p>By the way, <code>DriverEntry</code> is just the <code>main</code> of the driver.</p><h3 id=drivers-who-dis>Drivers&mldr; Who dis?<a hidden class=anchor aria-hidden=true href=#drivers-who-dis>#</a></h3><p>Drivers are Structured, High Privilege Deployable Kernel modules operating in Ring 0 processor privilege level (only kernel-mode drivers), same as the kernel. Initially, Ring 1 and Ring 2 were reserved for drivers but nobody uses them anymore.</p><p>Drivers provide a way to interact with (in most cases) hardware devices. These are called Hardware Drivers. On the contrary, software components that execute kernel-level privilege tasks such as file creation, are classified under Software Drivers.</p><p>To write drivers, you need to follow a set of guidelines, conventions, and structures, all these together combine to form a Driver Framework. Two of these exist -> Windows Driver Model (WDM) and Windows Driver Foundation (WDF).</p><h3 id=wdm-vs-wdf>WDM vs WDF<a hidden class=anchor aria-hidden=true href=#wdm-vs-wdf>#</a></h3><ul><li><p>Simply put, WDM is an older, more complex-to-work-with framework to write drivers. Ideal for writing File Systems or File System Filter drivers, WDM provides greater control over kernel objects and is hard to write, debug, and maintain.</p><p>WDM objects are system-wide objects accessible to drivers and are referenced by pointers. A driver that corrupts a WDM object corrupts the entire system. WDM drivers are trusted kernel components, hence OS does fewer checks to validate data.</p><p>From a security perspective, leveraging a framework that provides higher control than WDF, would enable more stealth during offensive engagements.</p></li><li><p>WDF is a new, easier-to-work-with framework that abstracts a lot of details of WDM. It supports a coherent object model in which objects are invisible to drivers.</p><p>Corrupting a WDF Driver is not only more difficult - as the framework evaluates data being supplied - but also causes system-wide problems less often.</p><p>Apart from these, there are many more subtle differences such as how both handle I/O requests. For eg. In a WDM driver, I/O dispatch routines map to particular IRP codes whereas, in a WDF driver, the framework registers its own dispatch routines, follows some identical steps to WDM, and then invokes the driver&rsquo;s event callback functions.</p><p>Event callback functions do a more specific task than the general I/O dispatch routines of WDM.</p></li></ul><p>Regardless of details, the bottom line is, WDM is complex and much harder to work with while WDF is easier to understand, the tradeoff being the abstraction.</p><h3 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>#</a></h3><p>There are some tools and methodologies that are recommended while working with drivers.</p><p>To build and deploy drivers you require the Windows Software Development Kit (SDK), Windows Driver Kit (WDK), and Visual Studio 2022 (the latest as of this writing). You can find them <a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/download-the-wdk>here</a> and Visual Studio <a href=https://visualstudio.microsoft.com/downloads/>here</a>.</p><p>Make sure SDK and WDK versions match, this is important.</p><blockquote><p>Additionally, you&rsquo;d require a Visual Studio extension, &ldquo;Windows Driver Kit&rdquo;. That should be automatically installed if WDK is configured correctly.</p></blockquote><p>To test drivers, you&rsquo;ll need a <a href=https://www.microsoft.com/software-download/windows11>Windows</a> Virtual Machine, with Windows SDK and WDK installed.</p><p><a href=https://learn.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite>SysInternals Tools</a> is a must.</p><h3 id=final-thoughts>Final Thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h3><p>Driver Development is not something you do regularly unless you have to.</p><p>The purpose is to understand Windows internals and drivers to build anything from Anti-Virus Filter Drivers to Rootkits. Knowing Driver Development also develops Kernel Debugging skills which are great if you are interested in Windows vulnerability research.</p><p>In Part 2, you&rsquo;ll learn the Advanced Windows Internals concepts required to get started with drivers.</p><p>Stay Tuned.</p><p>Tx0actical. Out.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://Tx0actical.github.io/tags/drivers/>Drivers</a></li><li><a href=https://Tx0actical.github.io/tags/windows/>Windows</a></li></ul><nav class=paginav><a class=prev href=https://Tx0actical.github.io/posts/win-drivers/win-drivers-p2/><span class=title>« Prev</span><br><span>0x02 Advanced Windows Internals</span></a>
<a class=next href=https://Tx0actical.github.io/posts/first-post/><span class=title>Next »</span><br><span>System Idle Process 0</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 0x01 Introduction and Fundamentals on twitter" href="https://twitter.com/intent/tweet/?text=0x01%20Introduction%20and%20Fundamentals&amp;url=https%3a%2f%2fTx0actical.github.io%2fposts%2fwin-drivers%2fwin-drivers-p1%2f&amp;hashtags=Drivers%2cWindows"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 0x01 Introduction and Fundamentals on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fTx0actical.github.io%2fposts%2fwin-drivers%2fwin-drivers-p1%2f&amp;title=0x01%20Introduction%20and%20Fundamentals&amp;summary=0x01%20Introduction%20and%20Fundamentals&amp;source=https%3a%2f%2fTx0actical.github.io%2fposts%2fwin-drivers%2fwin-drivers-p1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://Tx0actical.github.io/>Tx0actical's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>